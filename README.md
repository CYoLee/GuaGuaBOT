
# GuaGuaBOT

GuaGuaBOT æ˜¯ä¸€å€‹æ”¯æ´å¤šäººç¦®åŒ…ç¢¼å…Œæ›èˆ‡æ´»å‹•æé†’çš„ Discord Botï¼Œæ­é…æœ¬åœ°ç«¯ `redeem_worker.py` è‡ªå‹•åŒ–è™•ç†æ‰€æœ‰å…Œæ›ä»»å‹™ã€‚

---

## âœ… åŠŸèƒ½ç¸½è¦½

### ğŸ ç¦®åŒ…ç¢¼å…Œæ›
- `/redeem_submit` æäº¤å…Œæ›ä»»å‹™çµ¦æœ¬åœ° Worker åŸ·è¡Œï¼Œæ”¯æ´å–®äººèˆ‡å¤šäººæ¨¡å¼ã€‚
  - âœ… è‡ªå‹•æ ¹æ“š Discord ä¼ºæœå™¨è¨˜éŒ„å„ä¼ºæœå™¨çš„ç©å®¶æ¸…å–®ã€‚
  - âœ… è¼¸å…¥æ–°ç©å®¶ ID æ™‚è‡ªå‹•å„²å­˜ã€‚
  - âœ… å›å‚³çµæœä»¿ç…§ log.txt æ ¼å¼æ•´ç†è¼¸å‡ºã€‚

### ğŸ‘¥ ç©å®¶ ID ç®¡ç†
- `/add_id` æ–°å¢ç©å®¶ ID
- `/remove_id` ç§»é™¤ç©å®¶ ID
- `/list_ids` åˆ—å‡ºæ‰€æœ‰å·²å„²å­˜çš„ç©å®¶ ID

### ğŸ”” æ´»å‹•æé†’ç³»çµ±
- `/add_notify` è¨­å®šæé†’ï¼ˆæ—¥æœŸèˆ‡æ™‚é–“åˆ†é–‹è¼¸å…¥ï¼‰ï¼Œæ”¯æ´ tag ä»–äºº
- `/remove_notify` åˆªé™¤æé†’ï¼ˆä¾ç…§é—œéµå­—ï¼‰
- `/list_notify` é¡¯ç¤ºç›®å‰æé†’åˆ—è¡¨
- âœ… é€šçŸ¥æ¨é€ä½¿ç”¨å°ç£æ™‚å€ (Asia/Taipei)
- âœ… åŸ·è¡Œæ™‚é–“ Â±90 ç§’è‡ªå‹•æ¨æ’­

### ğŸ“– èªªæ˜æŒ‡ä»¤
- `/help` æ”¯æ´ä¸­è‹±æ–‡ç‰ˆæœ¬æŒ‡ä»¤èªªæ˜ï¼Œç¹é«”ä¸­æ–‡é¢¨æ ¼æ›´æ´»æ½‘

---

## ğŸ§  ç³»çµ±æ¶æ§‹

### Railwayï¼ˆä¸»ç¨‹å¼ï¼‰
- `bot.py`ï¼šä¸»ç¨‹å¼ï¼Œè¨»å†Š Slash æŒ‡ä»¤ä¸¦å•Ÿå‹•æ’ç¨‹ï¼ˆnotify_taskï¼‰
- `cogs/*.py`ï¼šæ¨¡çµ„åŒ–ç®¡ç†å„åŠŸèƒ½æŒ‡ä»¤
- âœ… é•·æ™‚é–“åœ¨ç·šï¼Œè² è²¬è™•ç†ä½¿ç”¨è€…æ“ä½œèˆ‡æ´»å‹•æ¨æ’­

### æœ¬åœ°ç«¯ï¼ˆåŸ·è¡Œå…Œæ›ï¼‰
- `redeem_worker.py`ï¼šæ¯ 15 ç§’æª¢æŸ¥ Firestore ä¸­çš„å…Œæ›ä»»å‹™ï¼Œè§¸ç™¼ `redeem.py` åŸ·è¡Œ
- `redeem.py`ï¼šåŸ·è¡Œ Selenium æ¨¡æ“¬å…Œæ›æµç¨‹ï¼Œè‡ªå‹•æˆªåœ–ä¸¦ä½¿ç”¨ OCR åˆ¤æ–·æ˜¯å¦æˆåŠŸ

---

## ğŸ—‚ï¸ Firestore çµæ§‹

### ids
```
/ids/{guild_id}/players/{doc_id}
  - player_id: "123456789"
```

### redeem_tasks
```
/redeem_tasks/{task_id}
  - code: "GIFT123"
  - player_id: "123456789"
  - channel_id: 123456789012345678
  - status: "pending" or "done"
  - result: "Success" / "Failed, Reason"
  - batch_id: "uuidç‰‡æ®µ" or None
  - completed_at: timestamp
```

### notifications
```
/notifications/{doc_id}
  - guild_id: "123456789"
  - channel_id: 123456789012345678
  - datetime: timestamp (Asia/Taipei)
  - mention: "@here"
  - message: "æ´»å‹•çµæŸå€’æ•¸ä¸€å°æ™‚"
```

---

## ğŸ“ ä½¿ç”¨æ•™å­¸

1. Railway ä¸Šéƒ¨ç½² `bot.py` ä¸»ç¨‹å¼
2. æœ¬åœ°ç«¯éƒ¨ç½² `redeem_worker.py` æ­é… Selenium åŸ·è¡Œç’°å¢ƒ
3. æ–¼ Discord è¼¸å…¥ `/redeem_submit` æäº¤ç¦®åŒ…ç¢¼ï¼ˆæ”¯æ´ç¾¤é«”èˆ‡å€‹åˆ¥ï¼‰
4. ç­‰å¾…å›å‚³çµ±æ•´çµæœï¼ˆä»¿ç…§ log.txtï¼‰
5. æŒ‡ä»¤åˆ—è¡¨ï¼šè«‹è¼¸å…¥ `/help` æŸ¥çœ‹èªªæ˜

---

## ğŸ‘¤ ä½œè€…

Author: GuaGua  
Version: 1.0  
Last Updated: 2025/04/05

